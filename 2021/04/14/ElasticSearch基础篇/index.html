<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>ElasticSearch基础篇 | WinKings Blogs</title><meta name="keywords" content="ElasticSearch,NoSQL,搜索"><meta name="author" content="WinKing"><meta name="copyright" content="WinKing"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="ElasticSearch基础篇一、入门介绍&amp;emsp;&amp;emsp;Lucene是一套信息检索工具包，是一个jar包，不包含搜索引擎系统！它包含：索引结构、读写索引的工具、排序，搜索规则。。。工具类！Lucene和ElasticSearch关系：&amp;emsp;&amp;emsp;ElasticSearch是基于Lucene做了一些封装和增强（上手十分简单！） 1、ElasticSearch概述&amp;emsp;&amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="ElasticSearch基础篇">
<meta property="og:url" content="http://cheng_qiwei.gitee.io/blog/2021/04/14/ElasticSearch%E5%9F%BA%E7%A1%80%E7%AF%87/index.html">
<meta property="og:site_name" content="WinKings Blogs">
<meta property="og:description" content="ElasticSearch基础篇一、入门介绍&amp;emsp;&amp;emsp;Lucene是一套信息检索工具包，是一个jar包，不包含搜索引擎系统！它包含：索引结构、读写索引的工具、排序，搜索规则。。。工具类！Lucene和ElasticSearch关系：&amp;emsp;&amp;emsp;ElasticSearch是基于Lucene做了一些封装和增强（上手十分简单！） 1、ElasticSearch概述&amp;emsp;&amp;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg">
<meta property="article:published_time" content="2021-04-14T14:00:00.000Z">
<meta property="article:modified_time" content="2021-04-22T13:58:10.693Z">
<meta property="article:author" content="WinKing">
<meta property="article:tag" content="ElasticSearch">
<meta property="article:tag" content="NoSQL">
<meta property="article:tag" content="搜索">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><link rel="shortcut icon" href="/blog/img/favicon.png"><link rel="canonical" href="http://cheng_qiwei.gitee.io/blog/2021/04/14/ElasticSearch%E5%9F%BA%E7%A1%80%E7%AF%87/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/blog/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/blog/WinKings%20Blogs" media="print" onload="this.media='all'"><script>var GLOBAL_CONFIG = { 
  root: '/blog/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}

// https://stackoverflow.com/questions/16839698/jquery-getscript-alternative-in-native-javascript
const getScript = url => new Promise((resolve, reject) => {
  const script = document.createElement('script')
  script.src = url
  script.async = true
  script.onerror = reject
  script.onload = script.onreadystatechange = function() {
    const loadState = this.readyState
    if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
    script.onload = script.onreadystatechange = null
    resolve()
  }
  document.head.appendChild(script)
})</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-04-22 21:58:10'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><meta name="generator" content="Hexo 5.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/blog/img/touxiang.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/blog/archives/"><div class="headline">文章</div><div class="length-num">20</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/blog/tags/"><div class="headline">标签</div><div class="length-num">38</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/blog/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/blog/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/blog/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/blog/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/blog/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/blog/">WinKings Blogs</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/blog/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/blog/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/blog/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/blog/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ElasticSearch基础篇</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-04-14T14:00:00.000Z" title="发表于 2021-04-14 22:00:00">2021-04-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-04-22T13:58:10.693Z" title="更新于 2021-04-22 21:58:10">2021-04-22</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/blog/categories/ElasticSearch/">ElasticSearch</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="ElasticSearch基础篇"><a href="#ElasticSearch基础篇" class="headerlink" title="ElasticSearch基础篇"></a>ElasticSearch基础篇</h1><h1 id="一、入门介绍"><a href="#一、入门介绍" class="headerlink" title="一、入门介绍"></a>一、入门介绍</h1><p>&emsp;&emsp;Lucene是一套信息检索工具包，是一个<font color='red'>jar包</font>，不包含搜索引擎系统！它包含：索引结构、读写索引的工具、排序，搜索规则。。。工具类！<br>Lucene和ElasticSearch关系：<br>&emsp;&emsp;ElasticSearch是基于Lucene做了一些封装和增强（上手十分简单！）</p>
<h2 id="1、ElasticSearch概述"><a href="#1、ElasticSearch概述" class="headerlink" title="1、ElasticSearch概述"></a>1、ElasticSearch概述</h2><p>&emsp;&emsp;Elaticsearch，简称为ES， ES是一个开源的高扩展的分布式全文检索引擎，它可以近乎实时的存储、检索数据；本身扩展性很好，可以扩展到上百台服务器，处理PB级别的数据。ES也使用Java开发并使用Lucene作为其核心来实现所有索引和搜索的功能，但是它的目的是通过简单的RESTful API来隐藏Lucene的复杂性，从而让全文搜索变得简单。<br>&emsp;&emsp;据国际权威的数据库产品评测机构DB Engines的统计，在2016年1月，ElasticSearch已超过Solr等，成为排名第一的搜索引擎类应用。</p>
<h2 id="2、历史"><a href="#2、历史" class="headerlink" title="2、历史"></a>2、历史</h2><p>&emsp;&emsp;多年前，一个叫做Shay Banon的刚结婚不久的失业开发者，由于妻子要去伦敦学习厨师，他便跟着也去了。在他找工作的过程中，为了给妻子构建一个食谱的搜索引擎，他开始构建一个早期版本的Lucene。<br>&emsp;&emsp;直接基于Lucene工作会比较困难，所以Shay开始抽象Lucene代码以便Java程序员可以在应用中添加搜索功能。他发布了他的第一个开源项目，叫做“Compass”。<br>&emsp;&emsp;后来Shay找到一份工作，这份工作处在高性能和内存数据网格的分布式环境中，因此高性能的、实时的、分布式的搜索引擎也是理所当然需要的。然后他决定重写Compass库使其成为一个独立的服务叫做Elasticsearch。<br>&emsp;&emsp;第一个公开版本出现在2010年2月，在那之后Elasticsearch已经成为Github上最受欢迎的项目之一，代码贡献者超过300人。一家主营Elasticsearch的公司就此成立，他们一边提供商业支持一边开发新功能，不过Elasticsearch将永远开源且对所有人可用。<br>Shay的妻子依旧等待着她的食谱搜索……</p>
<h2 id="3、谁在使用ES"><a href="#3、谁在使用ES" class="headerlink" title="3、谁在使用ES"></a>3、谁在使用ES</h2><p>1、维基百科，类似百度百科，全文检索，高亮，搜索推荐</p>
<p>2、The Guardian（国外新闻网站），类似搜狐新闻，用户行为日志（点击，浏览，收藏，评论）+社交网络数据（对某某新闻的相关看法），数据分析，给到每篇新闻文章的作者，让他知道他的文章的公众反馈（好，坏，热门，垃圾，鄙视，崇拜）</p>
<p>3、Stack Overflow（国外的程序异常讨论论坛），IT问题，程序的报错，提交上去，有人会跟你讨论和回答，全文检索，搜索相关问题和答案，程序报错了，就会将报错信息粘贴到里面去，搜索有没有对应的答案</p>
<p>4、GitHub（开源代码管理），搜索上千亿行代码</p>
<p>5、电商网站，检索商品</p>
<p>6、日志数据分析，logstash采集日志，ES进行复杂的数据分析，ELK技术，elasticsearch+logstash+kibana</p>
<p>7、商品价格监控网站，用户设定某商品的价格阈值，当低于该阈值的时候，发送通知消息给用户，比如说订阅牙膏的监控，如果高露洁牙膏的家庭套装低于50块钱，就通知我，我就去买</p>
<p>8、BI系统，商业智能，Business Intelligence。比如说有个大型商场集团，BI，分析一下某某区域最近3年的用户消费金额的趋势以及用户群体的组成构成，产出相关的数张报表，**区，最近3年，每年消费金额呈现100%的增长，而且用户群体85%是高级白领，开一个新商场。ES执行数据分析和挖掘，Kibana进行数据可视化</p>
<p>9、国内：站内搜索（电商，招聘，门户，等等），IT系统搜索（OA，CRM，ERP，等等），数据分析（ES热门的一个使用场景）</p>
<h1 id="二、ES和solr的差别"><a href="#二、ES和solr的差别" class="headerlink" title="二、ES和solr的差别"></a>二、ES和solr的差别</h1><h2 id="1、Elasticsearch简介"><a href="#1、Elasticsearch简介" class="headerlink" title="1、Elasticsearch简介"></a>1、Elasticsearch简介</h2><p>&emsp;&emsp;Elasticsearch是一个实时分布式搜索和分析引擎。它让你以前所未有的速度处理大数据成为可能。它用于<font color='red'>全文搜索、结构化搜索、分析以及将这三者混合使用</font>：</p>
<p>&emsp;&emsp;维基百科使用Elasticsearch提供全文搜索并高亮关键字，以及输入实时搜索(search-asyou-type)和搜索纠错(did-you-mean)等搜索建议功能。</p>
<p>&emsp;&emsp;英国卫报使用Elasticsearch结合用户日志和社交网络数据提供给他们的编辑以实时的反馈，以便及时了解公众对新发表的文章的回应。</p>
<p>&emsp;&emsp;StackOverflow结合全文搜索与地理位置查询，以及more-like-this功能来找到相关的问题和答案。</p>
<p>&emsp;&emsp;Github使用Elasticsearch检索1300亿行的代码。</p>
<p>&emsp;&emsp;但是Elasticsearch不仅用于大型企业，它还让像DataDog以及Klout这样的创业公司将最初的想法变成可扩展的解决方案。Elasticsearch可以在你的笔记本上运行，也可以在数以百计的服务器上处理PB级别的数据 。</p>
<p>&emsp;&emsp;Elasticsearch是一个基于Apache Lucene™的开源搜索引擎。无论在开源还是专有领域，Lucene可以被认为是迄今为止最先进、性能最好的、功能最全的搜索引擎库。</p>
<p>&emsp;&emsp;但是，Lucene只是一个库。想要使用它，你必须使用Java来作为开发语言并将其直接集成到你的应用中，更糟糕的是，Lucene非常复杂，你需要深入了解检索的相关知识来理解它是如何工作的。</p>
<p>&emsp;&emsp;Elasticsearch也使用Java开发并使用Lucene作为其核心来实现所有索引和搜索的功能，但是它的目的是通过简单的<strong>RESTful API</strong>  来隐藏Lucene的复杂性，从而让全文搜索变得简单。</p>
<h2 id="2、Solr简介"><a href="#2、Solr简介" class="headerlink" title="2、Solr简介"></a>2、Solr简介</h2><p>&emsp;&emsp;Solr 是Apache下的一个顶级开源项目，采用Java开发，它是基于Lucene的全文搜索服务器。Solr提供了比Lucene更为丰富的查询语言，同时实现了可配置、可扩展，并对索引、搜索性能进行了优化。</p>
<p>&emsp;&emsp;Solr可以独立运行，运行在Jetty、Tomcat等这些Servlet容器中，Solr 索引的实现方法很简单，<strong>用 POST方法向 Solr 服务器发送一个描述 Field 及其内容的 XML 文档，Solr根据xml文档添加、删除、更新索引</strong>。Solr 搜索只需要发送 HTTP GET 请求，然后对 Solr 返回Xml、json等格式的查询结果进行解析，组织页面布局。Solr不提供构建UI的功能，Solr提供了一个管理界面，通过管理界面可以查询Solr的配置和运行情况。</p>
<p>&emsp;&emsp;solr是基于lucene开发企业级搜索服务器，实际上就是封装了lucene。</p>
<p>&emsp;&emsp;Solr是一个独立的企业级搜索应用服务器，它对外提供类似于<strong>Web-service</strong>的API接口。用户可以通过http请求，向搜索引擎服务器提交一定格式的文件，生成索引；也可以通过提出查找请求，并得到返回结果。</p>
<h2 id="3、Lucene简介"><a href="#3、Lucene简介" class="headerlink" title="3、Lucene简介"></a>3、Lucene简介</h2><p>&emsp;&emsp;Lucene是apache软件基金会4 jakarta项目组的一个子项目，是一个开放源代码的全文检索引擎工具包，但它不是一个完整的全文检索引擎，而是一个全文检索引擎的架构，提供了完整的查询引擎和索引引擎，部分文本分析引擎（英文与德文两种西方语言）。Lucene的目的是为软件开发人员提供一个简单易用的工具包，以方便的在目标系统中实现全文检索的功能，或者是以此为基础建立起完整的全文检索引擎。Lucene是一套用于全文检索和搜寻的开源程式库，由Apache软件基金会支持和提供。Lucene提供了一个简单却强大的应用程式接口，能够做全文索引和搜寻。在Java开发环境里Lucene是一个成熟的免费开源工具。就其本身而言，Lucene是当前以及最近几年最受欢迎的免费Java信息检索程序库。人们经常提到信息检索程序库，虽然与搜索引擎有关，但不应该将信息检索程序库与搜索引擎相混淆。</p>
<p>&emsp;&emsp;Lucene是一个全文检索引擎的架构。那什么是全文搜索引擎？</p>
<p>&emsp;&emsp;全文搜索引擎是名副其实的搜索引擎，国外具代表性的有Google、Fast/AllTheWeb、AltaVista、Inktomi、Teoma、WiseNut等，国内著名的有百度（Baidu）。它们都是通过从互联网上提取的各个网站的信息（以网页文字为主）而建立的数据库中，检索与用户查询条件匹配的相关记录，然后按一定的排列顺序将结果返回给用户，因此他们是真正的搜索引擎。</p>
<p>&emsp;&emsp;从搜索结果来源的角度，全文搜索引擎又可细分为两种，一种是拥有自己的检索程序（Indexer），俗称“蜘蛛”（Spider）程序或“机器人”（Robot）程序，并自建网页数据库，搜索结果直接从自身的数据库中调用，如上面提到的7家引擎；另一种则是租用其他引擎的数据库，并按自定的格式排列搜索结果，如Lycos引擎。</p>
<h2 id="4、ElasticSearch和solr比较"><a href="#4、ElasticSearch和solr比较" class="headerlink" title="4、ElasticSearch和solr比较"></a>4、ElasticSearch和solr比较</h2><p><img src="http://cheng_qiwei.gitee.io/blog/img/354604-20180122010705803-1082290454.png"></p>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/354604-20180122010730865-1548826450.png" alt="354604-20180122010730865-1548826450"></p>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/354604-20180122010754100-1951694800.png" alt="354604-20180122010754100-1951694800"></p>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/354604-20180122011131225-347761833.png"></p>
<h1 id="三、ElasticSearch安装"><a href="#三、ElasticSearch安装" class="headerlink" title="三、ElasticSearch安装"></a>三、ElasticSearch安装</h1><p>&emsp;&emsp;声明：由于ElasticSearch使用Java开发，所以需要Java开发环境，其对JDK的版本最低要求是：JDK1.8！同时，由于要使用ElasticSearch客户端，界面工具，所以还需要nodejs的环境！</p>
<h2 id="1、下载资源【基于21-04-07】"><a href="#1、下载资源【基于21-04-07】" class="headerlink" title="1、下载资源【基于21-04-07】"></a>1、下载资源【基于21-04-07】</h2><h3 id="1-1、官方环境"><a href="#1-1、官方环境" class="headerlink" title="1.1、官方环境"></a>1.1、官方环境</h3><p>ElasticSearch[目前最新7.12.0]：<a target="_blank" rel="noopener" href="https://www.elastic.co/cn/downloads/elasticsearch">https://www.elastic.co/cn/downloads/elasticsearch</a></p>
<p>logstash[目前最新7.12.0]：<a target="_blank" rel="noopener" href="https://www.elastic.co/cn/downloads/logstash">https://www.elastic.co/cn/downloads/logstash</a></p>
<p>kibana[目前最新7.12.0]：<a target="_blank" rel="noopener" href="https://www.elastic.co/cn/downloads/kibana">https://www.elastic.co/cn/downloads/kibana</a></p>
<p>ik分词器[目前最新7.12.0]：<a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik/releases">https://github.com/medcl/elasticsearch-analysis-ik/releases</a></p>
<p>elasticsearch-head-master下载[目前最新5.0.0]：<a target="_blank" rel="noopener" href="https://github.com/mobz/elasticsearch-head/releases/tag/v5.0.0">https://github.com/mobz/elasticsearch-head/releases/tag/v5.0.0</a></p>
<h3 id="1-2、华为云的镜像去下载"><a href="#1-2、华为云的镜像去下载" class="headerlink" title="1.2、华为云的镜像去下载"></a>1.2、华为云的镜像去下载</h3><p>速度很快，自己找对应版本就可以<br>ElasticSearch[目前最新7.9.3]： <a target="_blank" rel="noopener" href="https://mirrors.huaweicloud.com/elasticsearch/?C=N&amp;O=D">https://mirrors.huaweicloud.com/elasticsearch/?C=N&amp;O=D</a></p>
<p>logstash[目前最新7.9.3]： <a target="_blank" rel="noopener" href="https://mirrors.huaweicloud.com/logstash/?C=N&amp;O=D">https://mirrors.huaweicloud.com/logstash/?C=N&amp;O=D</a></p>
<p>kibana[目前最新7.9.3]： <a target="_blank" rel="noopener" href="https://mirrors.huaweicloud.com/kibana/?C=N&amp;O=D">https://mirrors.huaweicloud.com/kibana/?C=N&amp;O=D</a></p>
<h2 id="2、window环境安装ElasticSearch"><a href="#2、window环境安装ElasticSearch" class="headerlink" title="2、window环境安装ElasticSearch"></a>2、window环境安装ElasticSearch</h2><h3 id="2-1、安装ElasticSearch"><a href="#2-1、安装ElasticSearch" class="headerlink" title="2.1、安装ElasticSearch"></a>2.1、安装ElasticSearch</h3><p>&emsp;&emsp;解压安装包即可</p>
<h3 id="2-2、熟悉目录"><a href="#2-2、熟悉目录" class="headerlink" title="2.2、熟悉目录"></a>2.2、熟悉目录</h3><p>bin：启动文件(.bat)<br>config：配置文件<br>​    log4j2.properties：日志配置文件<br>​    jvm.options：java虚拟机的配置<br>​    elasticsearch.yml：ES的配置文件 端口9200 ！跨域问题<br>data：索引数据目录<br>lib：相关Jar包<br>logs：日志<br>modules：功能模块<br>plugins：插件</p>
<p>jvm的配置调整一下，需要更改虚拟机配置改为256M</p>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/image-20210407155353343.png" alt="image-20210407155353343"></p>
<p>调整ElasticSearch.yml文件，添加以下内容，解决跨域问题</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http.cors.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">http.cors.allow-origin:</span> <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3、启动"><a href="#2-3、启动" class="headerlink" title="2.3、启动"></a>2.3、启动</h3><p>&emsp;&emsp;双击ElasticSearch下的bin目录中的elasticsearch.bat启动，控制台显示的日志（等待启动完<br>毕！）：</p>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/image-20210407173536506.png" alt="image-20210407173536506"></p>
<h3 id="2-4、访问测试"><a href="#2-4、访问测试" class="headerlink" title="2.4、访问测试"></a>2.4、访问测试</h3><p><img src="http://cheng_qiwei.gitee.io/blog/img/image-20210407173520663.png" alt="image-20210407173520663"></p>
<h2 id="3、windows环境安装可视化界面ES-head"><a href="#3、windows环境安装可视化界面ES-head" class="headerlink" title="3、windows环境安装可视化界面ES head"></a>3、windows环境安装可视化界面ES head</h2><p>&emsp;&emsp;Head是elasticsearch的集群管理工具，可以用于数据的浏览查询。</p>
<h3 id="3-1、安装head"><a href="#3-1、安装head" class="headerlink" title="3.1、安装head"></a>3.1、安装head</h3><h4 id="3-1-1、解压安装包即可"><a href="#3-1-1、解压安装包即可" class="headerlink" title="3.1.1、解压安装包即可"></a>3.1.1、解压安装包即可</h4><h4 id="3-1-2、解压之后安装依赖并启动，访问端口9100"><a href="#3-1-2、解压之后安装依赖并启动，访问端口9100" class="headerlink" title="3.1.2、解压之后安装依赖并启动，访问端口9100"></a>3.1.2、解压之后安装依赖并启动，访问端口9100</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cnpm install</span><br><span class="line">npm run start</span><br></pre></td></tr></table></figure>

<p><font color='red'>&emsp;&emsp;注：由于ES进程和客户端进程端口号不同，存在跨域问题，所以我们要在ES的配置文件中配置下跨域问题</font></p>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/image-20210408100717533.png" alt="image-20210408100717533"></p>
<p>初学就把ES当做一个数据库！可以建立索引（库），文档（库中的数据）</p>
<p>head就当做一个数据展示工具！后面所有的查询用Kibana！</p>
<h2 id="4、了解ELK"><a href="#4、了解ELK" class="headerlink" title="4、了解ELK"></a>4、了解ELK</h2><p>&emsp;&emsp;ELK是Elasticsearch、Logstash、Kibana三大开源框架首字母大写简称。市面上也被成为Elastic Stack。其中Elasticsearch是一个基于Lucene、分布式、通过Restful方式进行交互的近实时搜索平台框架。像类似百度、谷歌这种大数据全文搜索引擎的场景都可以使用Elasticsearch作为底层支持框架，可见Elasticsearch提供的搜索能力确实强大,市面上很多时候我们简称Elasticsearch为ES。Logstash是ELK的中央数据流引擎，用于从不同目标（文件/数据存储/MQ）收集的不同格式数据，经过过滤后支持输出到不同目的地（文件/MQ/redis/elasticsearch/kafka等）。Kibana可以将elasticsearch的数据通过友好的页面展示出来，提供实时分析的功能。</p>
<p>&emsp;&emsp;市面上很多开发只要提到ELK能够一致说出它是一个日志分析架构技术栈总称，但实际上ELK不仅仅适用于**<font color='red'>日志分析，它还可以支持其它任何数据分析和收集的场景，日志分析和收集只是更具有代表性。并非唯一性。</font>**</p>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/image-20210408102825233.png" alt="image-20210408102825233"></p>
<h2 id="5、windows环境安装Kibana"><a href="#5、windows环境安装Kibana" class="headerlink" title="5、windows环境安装Kibana"></a>5、windows环境安装Kibana</h2><p>&emsp;&emsp;Kibana是一个针对Elasticsearch的开源分析及可视化平台，用来搜索、查看交互存储在Elasticsearch索引中的数据。使用Kibana，可以通过各种图表进行高级数据分析及展示。Kibana让海量数据更容易理解。它操作简单，基于浏览器的用户界面可以快速创建仪表板（dashboard）实时显示Elasticsearch查询动态。设置Kibana非常简单。无需编码或者额外的基础架构，几分钟内就可以完成Kibana安装并启动Elasticsearch索引监测。</p>
<h3 id="5-1、安装Kibana"><a href="#5-1、安装Kibana" class="headerlink" title="5.1、安装Kibana"></a>5.1、安装Kibana</h3><p>5.1.1、将压缩包解压即可（需要一些时间），是一个标准的工程<br>5.1.2、然后进入到bin目录下，启动服务就可以了（需要等待启动完成），ELK基本上都是拆箱即用的</p>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/image-20210408102253163.png" alt="image-20210408102253163"></p>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/image-20210408102401994.png" alt="image-20210408102401994"></p>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/image-20210408102414725.png" alt="image-20210408102414725"></p>
<h3 id="5-2、语言配置"><a href="#5-2、语言配置" class="headerlink" title="5.2、语言配置"></a>5.2、语言配置</h3><p>&emsp;&emsp;Kibana支持中文，中文包位置：kibana\x-pack\plugins\translations\ translations\zh-CN.json，只需要在配置文件 kibana.yml 中加入如下内容并重启Kibana即可。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i18n.locale: &quot;zh-CN&quot;</span><br></pre></td></tr></table></figure>

<p><img src="http://cheng_qiwei.gitee.io/blog/img/image-20210408103349839.png" alt="image-20210408103349839"></p>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/image-20210408103659934.png" alt="image-20210408103659934"></p>
<h1 id="四、ES核心概念"><a href="#四、ES核心概念" class="headerlink" title="四、ES核心概念"></a>四、ES核心概念</h1><h2 id="1、ElasticSearch与传统关系型数据库的比较"><a href="#1、ElasticSearch与传统关系型数据库的比较" class="headerlink" title="1、ElasticSearch与传统关系型数据库的比较"></a>1、ElasticSearch与传统关系型数据库的比较</h2><p>&emsp;&emsp;在前面的学习中，我们已经掌握了es是什么，同时也把es的服务已经安装启动，那么es是如何去存储数据，数据结构是什么，又是如何实现搜索的呢？我们先来聊聊ElasticSearch的相关概念吧！</p>
<p>问题：集群，节点，索引，类型，文档，分片，映射是什么？</p>
<h2 id="2、索引（index）"><a href="#2、索引（index）" class="headerlink" title="2、索引（index）"></a>2、索引（index）</h2><p>&emsp;&emsp;索引是ES的一个逻辑存储，对应关系型数据库中的数据库，ES可以把索引数据存放到服务器中，也可以sharding(分片)后存储到多台服务器上。每个索引有一个或多个分片，每个分片可以有多个副本。</p>
<p>&emsp;&emsp;一个ElasticSearch可以就是一个集群，默认的集群名称就是elasticsearch。一个集群至少有一个节点，而一个节点就是一个elasricsearch进程，节点可以有多个索引默认的，如果你创建索引，那么索引将会有个5个分片 ( primary shard ,又称主分片 ) 构成的，<font color='red'>每份分片是一个Lucene的索引</font>，每一个主分片会有一个副本 ( replica shard ,又称复制分片 )。</p>
<p>&emsp;&emsp;在一个多节点的ElasticSearch集群中，<font color='red'>主分片和对应的复制分片都不会在同一个节点内，这样有利于某个节点挂掉 了，数据也不至于丢失</font>。 实际上，一个分片是一个Lucene索引，一个包含倒排索引的文件目录，倒排索引的结构使 得elasticsearch在不扫描全部文档的情况下，就能告诉你哪些文档包含特定的关键字。</p>
<h3 id="2-1、分片（shard）"><a href="#2-1、分片（shard）" class="headerlink" title="2.1、分片（shard）"></a><font color='red'>2.1、分片（shard）</font></h3><p>&emsp;&emsp;如果我们的索引数据量很大，超过硬件存放单个文件的限制，就会影响查询请求的速度，ES引入了分片技术。一个分片本身就是一个完整的搜索引擎，文档存储在分片中，而分片会被分配到集群中的各个节点中，随着集群的扩大和缩小，ES会自动的将分片在节点之间进行迁移，以保证集群能保持一种平衡。分片有以下特点：</p>
<ol>
<li>ES的一个索引可以包含多个分片（shard）；</li>
<li>每一个分片（shard）都是一个最小的工作单元，承载部分数据；</li>
<li>每个shard都是一个lucene实例，有完整的建立索引和处理请求的能力；</li>
<li>增减节点时，shard会自动在nodes中负载均衡；</li>
<li>一个文档只能完整的存放在一个shard上（主节点）</li>
<li>一个索引中含有shard的数量，默认值为5，在索引创建后这个值是不能被更改的。</li>
<li>优点：水平分割和扩展我们存放的内容索引；分发和并行跨碎片操作提高性能/吞吐量；</li>
<li>每一个shard关联的副本分片（replica shard）的数量，默认值为1，这个设置在任何时候都可以修改。</li>
<li>Pshard（主分片）和对应的Rshard（副本）<strong>不能同时存在于同一个节点</strong>，所以最低的可用配置是两个节点，互为主备。</li>
<li>primary shard【主分片】是可读可写的，而replica shard【分片副本】是只读的。</li>
</ol>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">分片的好处：</span><br><span class="line">1.当某一台服务器宕机，可以保证其他数据的完整性（非最优方案）</span><br><span class="line">2.横向扩容：当数据量增大时，只需要添加一个新的结点，然后创建新的索引，操作非常简单</span><br><span class="line">3.看似占用了更多的服务器资源，实际上replica shard带来了性能和集群吞吐量的提升，这点和横向扩容是相同的。</span><br><span class="line">不同的是，横向扩容是可以承载更多的数据，而replica shard是单纯的增加数据的副本，带来的是性能和高可用。</span><br></pre></td></tr></table></figure>

<p><font color='red'>&emsp;&emsp;被混淆的概念是，一个 Lucene 索引 我们在 Elasticsearch 称作 分片 。 一个 Elasticsearch 索引 是分片的集合。 当 Elasticsearch 在索引中搜索的时候， 他发送查询到每一个属于索引的分片(Lucene 索引)，然后合并每个分片的结果到一个全局的结果集。</font></p>
<h3 id="2-2、副本（replica）"><a href="#2-2、副本（replica）" class="headerlink" title="2.2、副本（replica）"></a>2.2、副本（replica）</h3><p>副本（replica shard）就是shard的冗余备份，它的主要作用：</p>
<ol>
<li>冗余备份，防止数据丢失；</li>
<li>shard异常时负责容错和负载均衡；</li>
</ol>
<h2 id="3、类型（type）"><a href="#3、类型（type）" class="headerlink" title="3、类型（type）"></a>3、类型（type）</h2><p>&emsp;&emsp;ES中，一个索引可以存储多个用于不同用途的对象，可以通过类型来区分索引中的不同对象，对应关系型数据库中表的概念。类型在各个版本的elasticsearch中的变化如下图：</p>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618651424501.png" alt="1618651424501"></p>
<p>&emsp;&emsp;我们都知道elasticsearch是基于Lucene开发的搜索引擎，而ES中不同type下名称相同的filed最终在Lucene中的处理方式是一样的。举个例子，两个不同type下的两个user_name，在ES同一个索引下其实被认为是同一个filed，你必须在两个不同的type中定义相同的filed映射。否则，不同type中的相同字段名称就会在处理中出现冲突的情况，导致Lucene处理效率下降。</p>
<p>&emsp;&emsp;去掉type能够使数据存储在独立的index中，这样即使有相同的字段名称也不会出现冲突，就像ElasticSearch出现的第一句话一样“你知道的，为了搜索····”，去掉type就是为了提高ES处理数据的效率。</p>
<p>&emsp;&emsp;除此之外，在同一个索引的不同type下存储字段数不一样的实体会导致存储中出现稀疏数据，影响Lucene压缩文档的能力，导致ES查询效率的降低。</p>
<h2 id="4、文档（document）"><a href="#4、文档（document）" class="headerlink" title="4、文档（document）"></a>4、文档（document）</h2><p>&emsp;&emsp;存储在ES中的主要实体叫文档，可以理解为关系型数据库中表的一行数据记录。每个文档由多个<strong>字段（field）</strong>组成。区别于关系型数据库的是，ES是一个非结构化的数据库，每个文档可以有不同的字段，并且有一个唯一标识。</p>
<p>&emsp;&emsp;ElasticSearch是面向文档的，那么就意味着索引和搜索数据的最小单位是文档，在ElasticSearch中，文档有几个 重要属性 :</p>
<ul>
<li><p>自我包含，一篇文档同时包含字段和对应的值，也就是同时包含 key:value</p>
</li>
<li><p>可以是层次型的，一个文档中包含自文档，复杂的逻辑实体就是这么来的！{就是一个JSON对象}</p>
</li>
<li><p>灵活的结构，文档不依赖预先定义的模式，我们知道关系型数据库中，要提前定义字段才能使用，在elasticsearch中，对于字段是非常灵活的，有时候，我们可以忽略该字段，或者动态的添加一个新的字段。</p>
</li>
</ul>
<p>&emsp;&emsp;尽管我们可以随意的新增或者忽略某个字段，但是，每个字段的类型非常重要，比如一个年龄字段类型，可以是字符 串也可以是整形。因为elasticsearch会保存字段和类型之间的映射及其他的设置。这种映射具体到每个映射的每种类型，这也是为什么在elasticsearch中，类型有时候也称为映射类型。</p>
<h2 id="5、映射（mapping）"><a href="#5、映射（mapping）" class="headerlink" title="5、映射（mapping）"></a>5、映射（mapping）</h2><p>&emsp;&emsp;mapping是处理数据的方式和规则方面做一些限制，如：某个字段的数据类型、默认值、分析器、是否被索引等等。这些都是映射里面可以设置的，其它就是处理ES里面数据的一些使用规则设置也叫做映射，按着最优规则处理数据对性能提高很大，因此才需要建立映射，并且需要思考如何建立映射才能对性能更好。</p>
<h1 id="五、IK分词器"><a href="#五、IK分词器" class="headerlink" title="五、IK分词器"></a>五、IK分词器</h1><h2 id="1、什么是分词器？什么是IK分词器？"><a href="#1、什么是分词器？什么是IK分词器？" class="headerlink" title="1、什么是分词器？什么是IK分词器？"></a>1、什么是分词器？什么是IK分词器？</h2><p>&emsp;&emsp;分词器，是将用户输入的一段文本，分析成符合逻辑的一种工具。而IK分词器，则是把一段中文划分成一个个的关键字，我们在搜索时候会把自己的信息进行分词，会把数据库中或者索引库中的数据进行分词，然后进行一个匹配操作。ElasticSearch默认的分词是将每个字看成一个词，比如 “我是程序员” 会被分为”我”,“是”,“程”,“序”,“员”，这显然是不符合要求的，所以我们需要安装使用IK中文分词器来解决这个问题。<br>&emsp;&emsp;IK提供了两个分词算法：ik_smart 和 ik_max_word，其中 ik_smart 为最少切分，ik_max_word为最细粒度划分。</p>
<h2 id="2、ElasticSearch安装IK分词器"><a href="#2、ElasticSearch安装IK分词器" class="headerlink" title="2、ElasticSearch安装IK分词器"></a>2、ElasticSearch安装IK分词器</h2><p>2.1、下载后解压，并将目录拷贝到ElasticSearch根目录下的 plugins 目录中</p>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/image-20210408153808172.png" alt="image-20210408153808172"></p>
<p>2.2、重新启动 ElasticSearch 服务，在启动过程中，你可以看到正在加载”analysis-ik”插件的提示信息，服务启动后，可以在命令行运行 elasticsearch-plugin list 命令，确认IK 插件安装成功。（ plugins 文件中不要放压缩包，否则会运行闪退！！）</p>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/image-20210408154000428.png" alt="image-20210408154000428"></p>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/image-20210408154054397.png" alt="image-20210408154054397"></p>
<p>2.3、在 kibana 中测试 IK分词器，并就相关分词结果和 icu 分词器进行对比。<br>IK提供了两个分词算法：ik_smart 和 ik_max_word。</p>
<p>ik_smart ：最少切分</p>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/image-20210408160321714.png" alt="image-20210408160321714"></p>
<p>ik_max_word： 最细粒度分词</p>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/image-20210408160345465.png" alt="image-20210408160345465"></p>
<h2 id="3、IK分词器自定义词库"><a href="#3、IK分词器自定义词库" class="headerlink" title="3、IK分词器自定义词库"></a>3、IK分词器自定义词库</h2><p>这里先说一下IK分词器中的词库文件的意思：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">IKAnalyzer.cfg.xml：IK分词配置文件</span><br><span class="line">主词库：main.dic</span><br><span class="line">英文停用词：stopword.dic，不会建立在倒排索引中</span><br><span class="line">特殊词库：</span><br><span class="line">    quantifier.dic：特殊词库：计量单位等</span><br><span class="line">    suffix.dic：特殊词库：后缀名</span><br><span class="line">    surname.dic：特殊词库：百家姓</span><br><span class="line">    preposition：特殊词库：语气词</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;虽然IK分词器能够帮助我们给中文进行分词，但是，随着当前互联网环境，各种热词的出现，使用IK分词器并不能完全满足我们的需求，所以，此时就需要我们自定义词库。</p>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/image-20210408162006057.png" alt="image-20210408162006057"></p>
<p>如图，如果我们想让系统识别“雨女无瓜”是一个词，需要编辑自定义词库。<br>自定义词库步骤：</p>
<h3 id="3-1、进入elasticsearch-plugins-ik-config目录"><a href="#3-1、进入elasticsearch-plugins-ik-config目录" class="headerlink" title="3.1、进入elasticsearch/plugins/ik/config目录"></a>3.1、进入elasticsearch/plugins/ik/config目录</h3><h3 id="3-2、新建一个owner-dic文件，编辑自定义内容"><a href="#3-2、新建一个owner-dic文件，编辑自定义内容" class="headerlink" title="3.2、新建一个owner.dic文件，编辑自定义内容"></a>3.2、新建一个owner.dic文件，编辑自定义内容</h3><p><font color='red'>注意查看创建的文件一定要是UTF-8编码，否则无效！</font></p>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/image-20210408162954456.png" alt="image-20210408162954456"></p>
<h3 id="3-3、修改IKAnalyzer-cfg-xml（在ik-config目录下）"><a href="#3-3、修改IKAnalyzer-cfg-xml（在ik-config目录下）" class="headerlink" title="3.3、修改IKAnalyzer.cfg.xml（在ik/config目录下）"></a>3.3、修改IKAnalyzer.cfg.xml（在ik/config目录下）</h3><p><img src="http://cheng_qiwei.gitee.io/blog/img/image-20210408163107567.png" alt="image-20210408163107567"></p>
<h3 id="3-4、修改完配置重新启动elasticsearch和Kibana，再次测试"><a href="#3-4、修改完配置重新启动elasticsearch和Kibana，再次测试" class="headerlink" title="3.4、修改完配置重新启动elasticsearch和Kibana，再次测试"></a>3.4、修改完配置重新启动elasticsearch和Kibana，再次测试</h3><p><img src="http://cheng_qiwei.gitee.io/blog/img/image-20210408163702063.png" alt="image-20210408163702063"></p>
<h3 id="3-5、再次测试，发现雨女无瓜变成了一个词"><a href="#3-5、再次测试，发现雨女无瓜变成了一个词" class="headerlink" title="3.5、再次测试，发现雨女无瓜变成了一个词"></a>3.5、再次测试，发现雨女无瓜变成了一个词</h3><p><img src="http://cheng_qiwei.gitee.io/blog/img/image-20210408164619279.png" alt="image-20210408164619279"></p>
<h1 id="六、ElasticSearch基于Rest风格的操作"><a href="#六、ElasticSearch基于Rest风格的操作" class="headerlink" title="六、ElasticSearch基于Rest风格的操作"></a>六、ElasticSearch基于Rest风格的操作</h1><h2 id="1、Rest风格说明"><a href="#1、Rest风格说明" class="headerlink" title="1、Rest风格说明"></a>1、Rest风格说明</h2><p>&emsp;&emsp;Rest风格是一种软件架构风格，而不是标准，它只是提供了一组设计原则和约束条件。它主要用于客户端和服务器交互类的软件。基于这个风格设计的软件可以更简洁，更有层次，更易于实现缓存等机制。</p>
<p>操作命令：</p>
<table>
<thead>
<tr>
<th align="center">method</th>
<th align="center">url地址</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">PUT</td>
<td align="center">ip:9200/索引名称/类型名称/文档id</td>
<td align="center">创建文档（指定文档id）</td>
</tr>
<tr>
<td align="center">POST</td>
<td align="center">ip:9200/索引名称/类型名称</td>
<td align="center">创建文档（随机文档id）</td>
</tr>
<tr>
<td align="center">POST</td>
<td align="center">ip:9200/索引名称/类型名称/文档id/_update</td>
<td align="center">修改文档</td>
</tr>
<tr>
<td align="center">DELETE</td>
<td align="center">ip:9200/索引名称/类型名称/文档id</td>
<td align="center">删除文档</td>
</tr>
<tr>
<td align="center">GET</td>
<td align="center">ip:9200/索引名称/类型名称/文档id</td>
<td align="center">通过文档id查询文档</td>
</tr>
<tr>
<td align="center">POST</td>
<td align="center">ip:9200/索引名称/类型名称/_search</td>
<td align="center">查询所有数据</td>
</tr>
</tbody></table>
<p>拓展命令</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>GET _cat/health</td>
<td>查看ElasticSearch的健康状态</td>
</tr>
<tr>
<td>GET _cat/indices?v</td>
<td>查看所有的索引信息</td>
</tr>
</tbody></table>
<h2 id="2、关于索引和文档的操作"><a href="#2、关于索引和文档的操作" class="headerlink" title="2、关于索引和文档的操作"></a>2、关于索引和文档的操作</h2><blockquote>
<p><strong>基础操作</strong></p>
</blockquote>
<h3 id="2-1、创建一个索引和文档，当索引存在时，仅创建文档"><a href="#2-1、创建一个索引和文档，当索引存在时，仅创建文档" class="headerlink" title="2.1、创建一个索引和文档，当索引存在时，仅创建文档"></a>2.1、创建一个索引和文档，当索引存在时，仅创建文档</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT test1/type1/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;:&quot;张三&quot;,</span><br><span class="line">  &quot;age&quot;:20,</span><br><span class="line">  &quot;date&quot;:&quot;2021-04-11&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618128008636.png" alt="1618128008636"></p>
<p>返回结果 （也是以REST ful 风格返回的 ）：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#! [types removal] Specifying types in document index requests is deprecated, use the typeless endpoints instead (/&#123;index&#125;/_doc/&#123;id&#125;, /&#123;index&#125;/_doc, or /&#123;index&#125;/_create/&#123;id&#125;).</span><br><span class="line"><span class="comment">// 警告信息：不支持在文档索引请求中指定类型，而是使用无类型的端点(/&#123;index&#125;/_doc/&#123;id&#125;， /&#123;index&#125;/_doc，或&#123;index&#125;/_create/&#123;id&#125;)。</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> : <span class="string">&quot;test1&quot;</span>,<span class="comment">// 索引</span></span><br><span class="line">  <span class="attr">&quot;_type&quot;</span> : <span class="string">&quot;type1&quot;</span>,<span class="comment">// 类型</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> : <span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> : <span class="number">1</span>,<span class="comment">// 版本</span></span><br><span class="line">  <span class="attr">&quot;result&quot;</span> : <span class="string">&quot;created&quot;</span>,<span class="comment">// 操作类型</span></span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> : &#123;<span class="comment">// 分片信息</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span> : <span class="number">2</span>,</span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> : <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> : <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> : <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>那么我们是否需要指定字段的类型呢？最好还是进行指定。</li>
</ul>
<table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">内容</th>
</tr>
</thead>
<tbody><tr>
<td align="center">字符串</td>
<td align="center">text、 keyword</td>
</tr>
<tr>
<td align="center">数值类型</td>
<td align="center">long, integer, short, byte, double, float, half_float, scaled_float</td>
</tr>
<tr>
<td align="center">日期类型</td>
<td align="center">date</td>
</tr>
<tr>
<td align="center">布尔类型</td>
<td align="center">boolean</td>
</tr>
<tr>
<td align="center">二进制类型</td>
<td align="center">binary</td>
</tr>
<tr>
<td align="center">…</td>
<td align="center">…</td>
</tr>
</tbody></table>
<h3 id="2-2、创建一个索引，并指定类型"><a href="#2-2、创建一个索引，并指定类型" class="headerlink" title="2.2、创建一个索引，并指定类型"></a>2.2、创建一个索引，并指定类型</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">PUT test2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;properties&quot;: &#123;</span><br><span class="line">      &quot;name&quot;:&#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;age&quot;:&#123;</span><br><span class="line">        &quot;type&quot;: &quot;long&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;birthday&quot;:&#123;</span><br><span class="line">        &quot;type&quot;: &quot;date&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618128978419.png" alt="1618128978419"></p>
<h3 id="2-3、查看索引-查看文档"><a href="#2-3、查看索引-查看文档" class="headerlink" title="2.3、查看索引/查看文档"></a>2.3、查看索引/查看文档</h3><h4 id="2-3-1、查看索引"><a href="#2-3-1、查看索引" class="headerlink" title="2.3.1、查看索引"></a>2.3.1、查看索引</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET test2</span><br></pre></td></tr></table></figure>

<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618129163728.png" alt="1618129163728"><br>&emsp;&emsp;假设按照2.1，我们并没有为我们的字段设置类型，那么当我们插入数据时，ElasticSearch就会去猜我们的类型，然后默认给我配置字段类型。</p>
<ul>
<li>这里需要注意的一个点：在elastisearch5版本之前，一个索引下可以创建多个类型，但是在elastisearch5后，一个索引只能对应一个类型，而id相当于关系型数据库的主键id若果不指定就会默认生成一个20位的uuid，属性相当关系型数据库的column(列)。</li>
</ul>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618129965125.png" alt="1618129965125"></p>
<h4 id="2-3-2、查看文档"><a href="#2-3-2、查看文档" class="headerlink" title="2.3.2、查看文档"></a>2.3.2、查看文档</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET test1/type1/1</span><br></pre></td></tr></table></figure>

<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618152483087.png" alt="1618152483087"></p>
<h3 id="2-4、修改文档"><a href="#2-4、修改文档" class="headerlink" title="2.4、修改文档"></a>2.4、修改文档</h3><blockquote>
<p>&emsp;&emsp;修改文档有两种方法进行修改，第一种如下图，使用和创建一样的命令 “<strong>PUT test1/type1/1</strong>”，但是这种方法需要我们把所有的字段都填充好，然后只修改我们需要修改的字段即可，如果漏掉不修改的字段的话，则会把其他文档删除。所以并不是建议使用这种方法进行修改操作。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PUT test1/type1/1/_update</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;:&quot;王五&quot; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618130388644.png" alt="1618130388644"></p>
<blockquote>
<p>&emsp;&emsp;另一个修改的方法是使用 “<strong>post test1/type1/1/_update</strong>” 来进行修改，该方法可以值修改目标字段，而不会影响其他不需要修改的字段。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">post test1/type1/1/_update</span><br><span class="line">&#123;</span><br><span class="line">  &quot;doc&quot;:&#123;</span><br><span class="line">    &quot;name&quot;:&quot;王五&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618139591034.png" alt="1618139591034"></p>
<h3 id="2-5、删除索引-删除文档"><a href="#2-5、删除索引-删除文档" class="headerlink" title="2.5、删除索引/删除文档"></a>2.5、删除索引/删除文档</h3><h4 id="2-5-1、删除文档"><a href="#2-5-1、删除文档" class="headerlink" title="2.5.1、删除文档"></a>2.5.1、删除文档</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE test1/type1/1</span><br></pre></td></tr></table></figure>

<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618151944650.png" alt="1618151944650"></p>
<p> <img src="http://cheng_qiwei.gitee.io/blog/img/1618151983146.png" alt="1618151983146"></p>
<h4 id="2-5-2、删除索引"><a href="#2-5-2、删除索引" class="headerlink" title="2.5.2、删除索引"></a>2.5.2、删除索引</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE test1</span><br></pre></td></tr></table></figure>

<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618152072436.png" alt="1618152072436"></p>
<blockquote>
<p>复杂搜索</p>
</blockquote>
<p>添加测试数据：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">PUT test1/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;:&quot;狂神说&quot;,</span><br><span class="line">  &quot;age&quot;:23,</span><br><span class="line">  &quot;desc&quot;:&quot;一顿操作猛如虎&quot;,</span><br><span class="line">  &quot;tags&quot;:[&quot;技术宅&quot;,&quot;暖那&quot;,&quot;指南&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT test1/_doc/2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;:&quot;张珊&quot;,</span><br><span class="line">  &quot;age&quot;:3,</span><br><span class="line">  &quot;desc&quot;:&quot;格雷福斯&quot;,</span><br><span class="line">  &quot;tags&quot;:[&quot;路由&quot;,&quot;交友&quot;,&quot;指南&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT test1/_doc/3</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;:&quot;李四&quot;,</span><br><span class="line">  &quot;age&quot;:30,</span><br><span class="line">  &quot;desc&quot;:&quot;mmp，不知道怎么形容&quot;,</span><br><span class="line">  &quot;tags&quot;:[&quot;靓女&quot;,&quot;旅游&quot;,&quot;唱歌&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618153275904.png" alt="1618153275904"></p>
<h3 id="2-6、根据单条件查询"><a href="#2-6、根据单条件查询" class="headerlink" title="2.6、根据单条件查询"></a>2.6、根据单条件查询</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET test1/_search?q=name:狂神</span><br><span class="line">GET test1/_search?q=name:狂神说</span><br></pre></td></tr></table></figure>

<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618154163657.png" alt="1618154163657"></p>
<p>&emsp;&emsp;我们发现，只要查询的目标字段包含我们的查询值，就能够被查询出来。</p>
<h3 id="2-7、多条件复杂查询"><a href="#2-7、多条件复杂查询" class="headerlink" title="2.7、多条件复杂查询"></a>2.7、多条件复杂查询</h3><p>添加数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PUT test1/_doc/4</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;:&quot;狂神说说说&quot;,</span><br><span class="line">  &quot;age&quot;:3,</span><br><span class="line">  &quot;desc&quot;:&quot;程序员~~~&quot;,</span><br><span class="line">  &quot;tags&quot;:[&quot;敲代码&quot;,&quot;码代码&quot;,&quot;删库跑路&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-7-1、指定输出内容"><a href="#2-7-1、指定输出内容" class="headerlink" title="2.7.1、指定输出内容"></a>2.7.1、指定输出内容</h3><p>&emsp;&emsp;有时候，我们并不需要输出文档中所有的内容，可能只需要输出某些字段就可以了。相当于sql中：SELECT name，age from ……</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET test1/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;狂神&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  , &quot;_source&quot;: [&quot;name&quot;,&quot;desc&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618156586615.png" alt="1618156586615"></p>
<p>&emsp;&emsp;这里我们会发现在结果中会有一项<code>_score</code>，这一项的作用是分数，用来判定结果应该怎么排序，分数越高说明越符合结果。</p>
<h3 id="2-7-2、对结果根据指定内容进行排序"><a href="#2-7-2、对结果根据指定内容进行排序" class="headerlink" title="2.7.2、对结果根据指定内容进行排序"></a>2.7.2、对结果根据指定内容进行排序</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET test1/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;狂神&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  , &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;age&quot;: &#123;</span><br><span class="line">        &quot;order&quot;: &quot;asc&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://cheng_qiwei.gitee.io/blog/img/image-20210412172751973.png" alt="image-20210412172751973"></p>
<p>&emsp;注意:在排序的过程中，只能使用可排序的属性进行排序。可以排序的属性有：<font color='red'>数字、日期、ID</font>，其他字段都不允许使用排序。在排序后，由于不需要使用<code>_score</code>发挥排序功能，所以该值被赋予null。</p>
<h3 id="2-7-3、分页查询"><a href="#2-7-3、分页查询" class="headerlink" title="2.7.3、分页查询"></a>2.7.3、分页查询</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET test1/_search</span><br><span class="line">&#123;</span><br><span class="line">   &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;狂神&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;from&quot;: 1,</span><br><span class="line">  &quot;size&quot;: 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618235374696.png" alt="1618235374696"></p>
<h3 id="2-7-4、布尔查询"><a href="#2-7-4、布尔查询" class="headerlink" title="2.7.4、布尔查询"></a>2.7.4、布尔查询</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GET test1/_search</span><br><span class="line">&#123;</span><br><span class="line">   &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;name&quot;: &quot;狂神&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;age&quot;: 23</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618235830392.png" alt="1618235830392"></p>
<p>同类型的关键词还有：</p>
<table>
<thead>
<tr>
<th>关键词</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>must</td>
<td>必须符合，必须包含，相当于关系数据库的条件and</td>
</tr>
<tr>
<td>must_not</td>
<td>必须不符合，必须不包含，相当于关系数据库的not XXX and not XXX</td>
</tr>
<tr>
<td>should</td>
<td>应该符合、应该包含，相当于关系数据库的条件or</td>
</tr>
</tbody></table>
<h3 id="2-7-5、过滤器查询"><a href="#2-7-5、过滤器查询" class="headerlink" title="2.7.5、过滤器查询"></a>2.7.5、过滤器查询</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">GET test1/_search</span><br><span class="line">&#123;</span><br><span class="line">   &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;name&quot;: &quot;狂神&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;range&quot;: &#123;</span><br><span class="line">          &quot;age&quot;: &#123;</span><br><span class="line">            &quot;gte&quot;: 5,</span><br><span class="line">            &quot;lte&quot;: 30</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618236985421.png" alt="1618236985421"></p>
<p>过滤器中同类型的关键词还有：</p>
<table>
<thead>
<tr>
<th>关键词</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>gte</td>
<td>大于等于</td>
</tr>
<tr>
<td>gt</td>
<td>大于</td>
</tr>
<tr>
<td>lte</td>
<td>小于等于</td>
</tr>
<tr>
<td>lt</td>
<td>小于</td>
</tr>
</tbody></table>
<h3 id="2-7-6、同一个字段多条件查询"><a href="#2-7-6、同一个字段多条件查询" class="headerlink" title="2.7.6、同一个字段多条件查询"></a>2.7.6、同一个字段多条件查询</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET test1/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;tags&quot;: &quot;南 技术宅&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  , &quot;_source&quot;: [&quot;name&quot;,&quot;tags&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618237486207.png" alt="1618237486207"></p>
<p>&emsp;&emsp;条件越符合，分数越高！</p>
<h3 id="2-7-7、精确查询"><a href="#2-7-7、精确查询" class="headerlink" title="2.7.7、精确查询"></a>2.7.7、精确查询</h3><p>&emsp;&emsp;关于精确查询，就需要说明一下分词，刚刚上面都是使用match关键词来进行查询，match在使用的时候会使用分词器进行解析，先解析文档，再通过文档进行查询，而如果需要进行精确查询，则应该使用关键词term。</p>
<p>&emsp;&emsp;另外，关于字符串的两个类型text和keyword，如果使用keyword作为字符串的类型时，系统会默认将其当成一个简单字符串而不会对其进行分词解析，如果使用text，则会进行解析，如下图：</p>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618238101807.png" alt="1618238101807"></p>
<p>创建测试数据：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">PUT test3</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;properties&quot;: &#123;</span><br><span class="line">      &quot;name&quot;:&#123;</span><br><span class="line">        &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;desc&quot;:&#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT test3/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;:&quot;狂神说Java&quot;,</span><br><span class="line">  &quot;desc&quot;:&quot;狂神说Java&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST test3/_doc/2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;:&quot;狂神说前端&quot;,</span><br><span class="line">  &quot;desc&quot;:&quot;狂神说前端&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET test3/_search</span><br></pre></td></tr></table></figure>

<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618240186908.png" alt="1618240186908"></p>
<p>&emsp;&emsp;如上图：如果是对name进行查询，由于name是keyword类型，不会进行分词，所以只查询<code>狂</code>没办法查出内容，而desc是text类型，在查询的时候会进行分词，故能查询到数据。</p>
<h3 id="2-7-8、高亮查询"><a href="#2-7-8、高亮查询" class="headerlink" title="2.7.8、高亮查询"></a>2.7.8、高亮查询</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET test1/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;狂神&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;highlight&quot;: &#123;</span><br><span class="line">    &quot;fields&quot;: &#123;</span><br><span class="line">      &quot;name&quot;:&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618240573753.png" alt="1618240573753"></p>
<p>&emsp;&emsp;<code>&lt;em&gt;</code>是ElasticSearch的默认高亮标签，如果需要自定义高亮标签，如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET test1/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;狂神&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;highlight&quot;: &#123;</span><br><span class="line">    &quot;fields&quot;: &#123;</span><br><span class="line">      &quot;name&quot;:&#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;pre_tags&quot;: &quot;&lt;p class=&#x27;key&#x27; style=&#x27;color:red&#x27;&gt;&quot;,</span><br><span class="line">    &quot;post_tags&quot;: &quot;&lt;/p&gt;&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618240745932.png" alt="1618240745932"></p>
<h1 id="七、springboot集成ElasticSearch"><a href="#七、springboot集成ElasticSearch" class="headerlink" title="七、springboot集成ElasticSearch"></a>七、springboot集成ElasticSearch</h1><h2 id="1、创建测试工程"><a href="#1、创建测试工程" class="headerlink" title="1、创建测试工程"></a>1、创建测试工程</h2><p><img src="http://cheng_qiwei.gitee.io/blog/img/1618241960363.png" alt="1618241960363"></p>
<h2 id="2、修改pom文件"><a href="#2、修改pom文件" class="headerlink" title="2、修改pom文件"></a>2、修改pom文件</h2><p>&emsp;&emsp;创建工程后，我们需要做一个修改，要不然没办法和当前版本【7.12.0】进行连接，我们当前的springboot的版本是2.3.7，已经算是一个比较高的版本，但是其兼容的ElasticSearch的版本只是7.6.2版本，没办法与我们最新的7.12.0版本进行兼容，所以需要修改其版本。</p>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618243216191.png" alt="1618243216191"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">elasticsearch.version</span>&gt;</span>7.12.0<span class="tag">&lt;/<span class="name">elasticsearch.version</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618243784374.png" alt="1618243784374"></p>
<h2 id="3、编写RestHighLevelClient作为连接与操作es的对象"><a href="#3、编写RestHighLevelClient作为连接与操作es的对象" class="headerlink" title="3、编写RestHighLevelClient作为连接与操作es的对象"></a>3、编写RestHighLevelClient作为连接与操作es的对象</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.g4b.cheng.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 构建esClient连接对象</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ElasticSearchConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestHighLevelClient <span class="title">restHighLevelClient</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestHighLevelClient(RestClient.builder(<span class="keyword">new</span> HttpHost(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">9200</span>,<span class="string">&quot;http&quot;</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4、关于索引的操作"><a href="#4、关于索引的操作" class="headerlink" title="4、关于索引的操作"></a>4、关于索引的操作</h2><h3 id="4-1、创建索引"><a href="#4-1、创建索引" class="headerlink" title="4.1、创建索引"></a>4.1、创建索引</h3><p><img src="http://cheng_qiwei.gitee.io/blog/img/1618327422965.png" alt="1618327422965"></p>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618327458353.png" alt="1618327458353"></p>
<h3 id="4-2、判断索引是否存在"><a href="#4-2、判断索引是否存在" class="headerlink" title="4.2、判断索引是否存在"></a>4.2、判断索引是否存在</h3><p><img src="http://cheng_qiwei.gitee.io/blog/img/1618327882435.png" alt="1618327882435"></p>
<h3 id="4-3、删除索引"><a href="#4-3、删除索引" class="headerlink" title="4.3、删除索引"></a>4.3、删除索引</h3><p><img src="http://cheng_qiwei.gitee.io/blog/img/1618327936525.png" alt="1618327936525"></p>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618327960755.png" alt="18327960755"></p>
<h3 id="4-4、创建文档"><a href="#4-4、创建文档" class="headerlink" title="4.4、创建文档"></a>4.4、创建文档</h3><p><img src="http://cheng_qiwei.gitee.io/blog/img/1618329606711.png" alt="1618329606711"></p>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618329648338.png" alt="1618329648338"></p>
<h3 id="4-5、判断文档是否存在"><a href="#4-5、判断文档是否存在" class="headerlink" title="4.5、判断文档是否存在"></a>4.5、判断文档是否存在</h3><p><img src="http://cheng_qiwei.gitee.io/blog/img/1618329950424.png" alt="1618329950424"></p>
<h3 id="4-6、查询文档信息"><a href="#4-6、查询文档信息" class="headerlink" title="4.6、查询文档信息"></a>4.6、查询文档信息</h3><p><img src="http://cheng_qiwei.gitee.io/blog/img/1618330069068.png" alt="1618330069068"></p>
<h3 id="4-7、修改文档"><a href="#4-7、修改文档" class="headerlink" title="4.7、修改文档"></a>4.7、修改文档</h3><p><img src="http://cheng_qiwei.gitee.io/blog/img/1618330309597.png" alt="1618330309597"></p>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618330331727.png" alt="1618330331727"></p>
<h3 id="4-8、删除文档"><a href="#4-8、删除文档" class="headerlink" title="4.8、删除文档"></a>4.8、删除文档</h3><p><img src="http://cheng_qiwei.gitee.io/blog/img/1618330487465.png" alt="1618330487465"></p>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/1618330503605.png" alt="1618330503605"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除文档记录</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testDeleteDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        DeleteRequest deleteRequest = <span class="keyword">new</span> DeleteRequest(<span class="string">&quot;zzy_index&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">        deleteRequest.timeout(<span class="string">&quot;1s&quot;</span>);</span><br><span class="line">        DeleteResponse deleteResponse = client.delete(deleteRequest, RequestOptions.DEFAULT);</span><br><span class="line">        System.out.println(deleteResponse.status());</span><br><span class="line">        System.out.println(deleteResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//特殊的，真是的项目一般都会批量插入数据！</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testBulkRequest</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        BulkRequest bulkRequest = <span class="keyword">new</span> BulkRequest();</span><br><span class="line">        bulkRequest.timeout(<span class="string">&quot;10s&quot;</span>);</span><br><span class="line">        ArrayList&lt;User&gt; userList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        userList.add(<span class="keyword">new</span> User(<span class="string">&quot;zzy1&quot;</span>, <span class="number">3</span>));</span><br><span class="line">        userList.add(<span class="keyword">new</span> User(<span class="string">&quot;zzy2&quot;</span>, <span class="number">3</span>));</span><br><span class="line">        userList.add(<span class="keyword">new</span> User(<span class="string">&quot;zzy3&quot;</span>, <span class="number">3</span>));</span><br><span class="line">        userList.add(<span class="keyword">new</span> User(<span class="string">&quot;zhao1&quot;</span>, <span class="number">3</span>));</span><br><span class="line">        userList.add(<span class="keyword">new</span> User(<span class="string">&quot;zhao2&quot;</span>, <span class="number">3</span>));</span><br><span class="line">        userList.add(<span class="keyword">new</span> User(<span class="string">&quot;zhao3&quot;</span>, <span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//批处理请求</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; userList.size(); i++) &#123;</span><br><span class="line">            <span class="comment">//批量更新和批量删除，就在这里修改对应的请求就可以了</span></span><br><span class="line">            bulkRequest.add(<span class="keyword">new</span> IndexRequest(<span class="string">&quot;zzy_index&quot;</span>)</span><br><span class="line">                    .id(<span class="string">&quot;&quot;</span> + (i + <span class="number">1</span>))<span class="comment">//不指定ID，会生成随机ID</span></span><br><span class="line">                    .source(JSON.toJSONString(userList.get(i)), XContentType.JSON));</span><br><span class="line">        &#125;</span><br><span class="line">        BulkResponse bulkResponse = client.bulk(bulkRequest, RequestOptions.DEFAULT);</span><br><span class="line">        System.out.println(bulkResponse.hasFailures());<span class="comment">//是否失败 返回false 表示成功</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询</span></span><br><span class="line">    <span class="comment">//SearchRequest 搜索请求</span></span><br><span class="line">    <span class="comment">//SearchSourceBuilder 条件构造</span></span><br><span class="line">    <span class="comment">//HighlightBuilder 构建高亮</span></span><br><span class="line">    <span class="comment">//TermQueryBuilder 精确查询</span></span><br><span class="line">    <span class="comment">//MatchAllQueryBuilder  匹配所有</span></span><br><span class="line">    <span class="comment">// xxxbulider  对应刚才看到的所有命令！</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testSearch</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        SearchRequest searchRequest = <span class="keyword">new</span> SearchRequest(ESconst.ES_INDEX);</span><br><span class="line">        <span class="comment">//构建搜索条件</span></span><br><span class="line">        SearchSourceBuilder sourceBuilder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询条件 可以使用QueryBuilders工具来实现</span></span><br><span class="line">        <span class="comment">//QueryBuilders.termQuery() 精确匹配</span></span><br><span class="line">        <span class="comment">//QueryBuilders.matchAllQuery() 匹配所有</span></span><br><span class="line">        TermQueryBuilder termQueryBuilder = QueryBuilders.termQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zhao1&quot;</span>);</span><br><span class="line">        <span class="comment">//MatchAllQueryBuilder matchAllQueryBuilder = QueryBuilders.matchAllQuery();</span></span><br><span class="line">        sourceBuilder.query(termQueryBuilder);</span><br><span class="line">        sourceBuilder.from();<span class="comment">//分页</span></span><br><span class="line">        sourceBuilder.size();</span><br><span class="line">        sourceBuilder.timeout(<span class="keyword">new</span> TimeValue(<span class="number">60</span>, TimeUnit.SECONDS));</span><br><span class="line"></span><br><span class="line">        searchRequest.source(sourceBuilder);</span><br><span class="line">        SearchResponse searchResponse = client.search(searchRequest, RequestOptions.DEFAULT);</span><br><span class="line">        System.out.println(JSON.toJSONString(searchResponse.getHits()));</span><br><span class="line">        System.out.println(<span class="string">&quot;====================&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (SearchHit documentFields : searchResponse.getHits().getHits()) &#123;</span><br><span class="line">            System.out.println(documentFields.getSourceAsMap());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-11、批量插入数据"><a href="#4-11、批量插入数据" class="headerlink" title="4.11、批量插入数据"></a>4.11、批量插入数据</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 批量插入文档</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: cheng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/4/14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testBulkDoc</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    BulkRequest request = <span class="keyword">new</span> BulkRequest(ES_INDEX);</span><br><span class="line">    request.timeout(TimeValue.timeValueSeconds(<span class="number">3</span>));</span><br><span class="line">    List&lt;User&gt; userList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    Collections.addAll(userList ,<span class="keyword">new</span> User(<span class="string">&quot;小A&quot;</span>,<span class="number">10</span>,<span class="keyword">new</span> Date(<span class="number">1586849562</span>))</span><br><span class="line">            ,<span class="keyword">new</span> User(<span class="string">&quot;小B&quot;</span>,<span class="number">12</span>,<span class="keyword">new</span> Date(<span class="number">766308762</span>))</span><br><span class="line">            ,<span class="keyword">new</span> User(<span class="string">&quot;小C&quot;</span>,<span class="number">13</span>,<span class="keyword">new</span> Date(<span class="number">158449562</span>))</span><br><span class="line">            ,<span class="keyword">new</span> User(<span class="string">&quot;小D&quot;</span>,<span class="number">40</span>,<span class="keyword">new</span> Date(<span class="number">766306762</span>))</span><br><span class="line">            ,<span class="keyword">new</span> User(<span class="string">&quot;小E&quot;</span>,<span class="number">30</span>,<span class="keyword">new</span> Date(<span class="number">1586549562</span>))</span><br><span class="line">            ,<span class="keyword">new</span> User(<span class="string">&quot;小F&quot;</span>,<span class="number">32</span>,<span class="keyword">new</span> Date(<span class="number">1586849562</span>))</span><br><span class="line">            ,<span class="keyword">new</span> User(<span class="string">&quot;小G&quot;</span>,<span class="number">21</span>,<span class="keyword">new</span> Date(<span class="number">1586009562</span>)));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; userList.size(); i++) &#123;</span><br><span class="line">        request.add(<span class="keyword">new</span> IndexRequest().id(String.valueOf(i+<span class="number">1</span>))</span><br><span class="line">                .source(JSON.toJSONString(userList.get(i)),XContentType.JSON));</span><br><span class="line">    &#125;</span><br><span class="line">    BulkResponse response = restHighLevelClient.bulk(request,RequestOptions.DEFAULT);</span><br><span class="line">    log.info(<span class="string">&quot;返回批量插入文档结果是否失败：&quot;</span>+response.hasFailures());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://cheng_qiwei.gitee.io/blog/img/image-20210414160453565.png" alt="image-20210414160453565"></p>
<p><img src="http://cheng_qiwei.gitee.io/blog/img/image-20210414160505801.png" alt="image-20210414160505801"></p>
<h3 id="4-10、搜索"><a href="#4-10、搜索" class="headerlink" title="4.10、搜索"></a>4.10、搜索</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 搜索文档</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: cheng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/4/14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testSearchDoc</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SearchRequest request = <span class="keyword">new</span> SearchRequest(ES_INDEX);</span><br><span class="line">    SearchSourceBuilder searchBuilder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">    searchBuilder.timeout(TimeValue.timeValueSeconds(<span class="number">1</span>));</span><br><span class="line">    <span class="comment">//所有的搜索方式都可以通过QueryBuilders工具类进行获取</span></span><br><span class="line">    MatchQueryBuilder matchQueryBuilder = QueryBuilders.matchQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;小&quot;</span>);</span><br><span class="line">    searchBuilder.query(matchQueryBuilder)</span><br><span class="line">                .from(<span class="number">0</span>)</span><br><span class="line">                .size(<span class="number">3</span>);</span><br><span class="line">    request.source(searchBuilder);</span><br><span class="line">    SearchResponse response = restHighLevelClient.search(request,RequestOptions.DEFAULT);</span><br><span class="line">    log.info(<span class="string">&quot;返回查询结果：&#123;&#125;&quot;</span>,JSON.toJSONString(response.getHits()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://cheng_qiwei.gitee.io/blog/img/image-20210414161722807.png" alt="image-20210414161722807"></p>
<p>所有的内容都放在<strong>sourceAsMap</strong>中，可以遍历进行获取。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">WinKing</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://cheng_qiwei.gitee.io/blog/2021/04/14/ElasticSearch%E5%9F%BA%E7%A1%80%E7%AF%87/">http://cheng_qiwei.gitee.io/blog/2021/04/14/ElasticSearch%E5%9F%BA%E7%A1%80%E7%AF%87/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://cheng_qiwei.gitee.io/blog" target="_blank">WinKings Blogs</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/blog/tags/ElasticSearch/">ElasticSearch</a><a class="post-meta__tags" href="/blog/tags/NoSQL/">NoSQL</a><a class="post-meta__tags" href="/blog/tags/%E6%90%9C%E7%B4%A2/">搜索</a></div><div class="post_share"><div class="addthis_inline_share_toolbox"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=null" async="async"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/blog/2021/04/22/ElasticSearch%E9%AB%98%E7%BA%A7%E7%AF%87/"><img class="prev-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/blog/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">ElasticSearch高级篇</div></div></a></div><div class="next-post pull-right"><a href="/blog/2021/04/10/HashMap%E5%92%8CConCurrentHashMap%E6%80%BB%E7%BB%93%E4%B8%8E%E9%9D%A2%E8%AF%95%E9%A2%98/"><img class="next-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/blog/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">HashMap和ConCurrentHashMap总结与面试</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/blog/2021/04/22/ElasticSearch高级篇/" title="ElasticSearch高级篇"><img class="cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-22</div><div class="title">ElasticSearch高级篇</div></div></a></div><div><a href="/blog/2021/04/23/ELasticSearch面试题/" title="ElasticSearch面试题"><img class="cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-23</div><div class="title">ElasticSearch面试题</div></div></a></div></div></div></div><div class="aside_content" id="aside_content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><img class="avatar-img" src="/blog/img/touxiang.jpg" onerror="this.onerror=null;this.src='/blog/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">WinKing</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/blog/archives/"><div class="headline">文章</div><div class="length-num">20</div></a></div><div class="card-info-data-item is-center"><a href="/blog/tags/"><div class="headline">标签</div><div class="length-num">38</div></a></div><div class="card-info-data-item is-center"><a href="/blog/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://gitee.com/cheng_qiwei"><i class="fab fa-gitee"></i><span>Follow Me</span></a></div></div><div class="card-widget card-announcement"><div class="card-content"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="card-content"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ElasticSearch%E5%9F%BA%E7%A1%80%E7%AF%87"><span class="toc-text">ElasticSearch基础篇</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D"><span class="toc-text">一、入门介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81ElasticSearch%E6%A6%82%E8%BF%B0"><span class="toc-text">1、ElasticSearch概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%8E%86%E5%8F%B2"><span class="toc-text">2、历史</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E8%B0%81%E5%9C%A8%E4%BD%BF%E7%94%A8ES"><span class="toc-text">3、谁在使用ES</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81ES%E5%92%8Csolr%E7%9A%84%E5%B7%AE%E5%88%AB"><span class="toc-text">二、ES和solr的差别</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81Elasticsearch%E7%AE%80%E4%BB%8B"><span class="toc-text">1、Elasticsearch简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81Solr%E7%AE%80%E4%BB%8B"><span class="toc-text">2、Solr简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81Lucene%E7%AE%80%E4%BB%8B"><span class="toc-text">3、Lucene简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81ElasticSearch%E5%92%8Csolr%E6%AF%94%E8%BE%83"><span class="toc-text">4、ElasticSearch和solr比较</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81ElasticSearch%E5%AE%89%E8%A3%85"><span class="toc-text">三、ElasticSearch安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E4%B8%8B%E8%BD%BD%E8%B5%84%E6%BA%90%E3%80%90%E5%9F%BA%E4%BA%8E21-04-07%E3%80%91"><span class="toc-text">1、下载资源【基于21-04-07】</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1%E3%80%81%E5%AE%98%E6%96%B9%E7%8E%AF%E5%A2%83"><span class="toc-text">1.1、官方环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2%E3%80%81%E5%8D%8E%E4%B8%BA%E4%BA%91%E7%9A%84%E9%95%9C%E5%83%8F%E5%8E%BB%E4%B8%8B%E8%BD%BD"><span class="toc-text">1.2、华为云的镜像去下载</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81window%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85ElasticSearch"><span class="toc-text">2、window环境安装ElasticSearch</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1%E3%80%81%E5%AE%89%E8%A3%85ElasticSearch"><span class="toc-text">2.1、安装ElasticSearch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2%E3%80%81%E7%86%9F%E6%82%89%E7%9B%AE%E5%BD%95"><span class="toc-text">2.2、熟悉目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3%E3%80%81%E5%90%AF%E5%8A%A8"><span class="toc-text">2.3、启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4%E3%80%81%E8%AE%BF%E9%97%AE%E6%B5%8B%E8%AF%95"><span class="toc-text">2.4、访问测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81windows%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2ES-head"><span class="toc-text">3、windows环境安装可视化界面ES head</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1%E3%80%81%E5%AE%89%E8%A3%85head"><span class="toc-text">3.1、安装head</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1%E3%80%81%E8%A7%A3%E5%8E%8B%E5%AE%89%E8%A3%85%E5%8C%85%E5%8D%B3%E5%8F%AF"><span class="toc-text">3.1.1、解压安装包即可</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2%E3%80%81%E8%A7%A3%E5%8E%8B%E4%B9%8B%E5%90%8E%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96%E5%B9%B6%E5%90%AF%E5%8A%A8%EF%BC%8C%E8%AE%BF%E9%97%AE%E7%AB%AF%E5%8F%A39100"><span class="toc-text">3.1.2、解压之后安装依赖并启动，访问端口9100</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E4%BA%86%E8%A7%A3ELK"><span class="toc-text">4、了解ELK</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81windows%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85Kibana"><span class="toc-text">5、windows环境安装Kibana</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1%E3%80%81%E5%AE%89%E8%A3%85Kibana"><span class="toc-text">5.1、安装Kibana</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2%E3%80%81%E8%AF%AD%E8%A8%80%E9%85%8D%E7%BD%AE"><span class="toc-text">5.2、语言配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81ES%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-text">四、ES核心概念</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81ElasticSearch%E4%B8%8E%E4%BC%A0%E7%BB%9F%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%AF%94%E8%BE%83"><span class="toc-text">1、ElasticSearch与传统关系型数据库的比较</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E7%B4%A2%E5%BC%95%EF%BC%88index%EF%BC%89"><span class="toc-text">2、索引（index）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1%E3%80%81%E5%88%86%E7%89%87%EF%BC%88shard%EF%BC%89"><span class="toc-text">2.1、分片（shard）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2%E3%80%81%E5%89%AF%E6%9C%AC%EF%BC%88replica%EF%BC%89"><span class="toc-text">2.2、副本（replica）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E7%B1%BB%E5%9E%8B%EF%BC%88type%EF%BC%89"><span class="toc-text">3、类型（type）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E6%96%87%E6%A1%A3%EF%BC%88document%EF%BC%89"><span class="toc-text">4、文档（document）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E6%98%A0%E5%B0%84%EF%BC%88mapping%EF%BC%89"><span class="toc-text">5、映射（mapping）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81IK%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-text">五、IK分词器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E5%88%86%E8%AF%8D%E5%99%A8%EF%BC%9F%E4%BB%80%E4%B9%88%E6%98%AFIK%E5%88%86%E8%AF%8D%E5%99%A8%EF%BC%9F"><span class="toc-text">1、什么是分词器？什么是IK分词器？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81ElasticSearch%E5%AE%89%E8%A3%85IK%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-text">2、ElasticSearch安装IK分词器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81IK%E5%88%86%E8%AF%8D%E5%99%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AF%8D%E5%BA%93"><span class="toc-text">3、IK分词器自定义词库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1%E3%80%81%E8%BF%9B%E5%85%A5elasticsearch-plugins-ik-config%E7%9B%AE%E5%BD%95"><span class="toc-text">3.1、进入elasticsearch&#x2F;plugins&#x2F;ik&#x2F;config目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2%E3%80%81%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AAowner-dic%E6%96%87%E4%BB%B6%EF%BC%8C%E7%BC%96%E8%BE%91%E8%87%AA%E5%AE%9A%E4%B9%89%E5%86%85%E5%AE%B9"><span class="toc-text">3.2、新建一个owner.dic文件，编辑自定义内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3%E3%80%81%E4%BF%AE%E6%94%B9IKAnalyzer-cfg-xml%EF%BC%88%E5%9C%A8ik-config%E7%9B%AE%E5%BD%95%E4%B8%8B%EF%BC%89"><span class="toc-text">3.3、修改IKAnalyzer.cfg.xml（在ik&#x2F;config目录下）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4%E3%80%81%E4%BF%AE%E6%94%B9%E5%AE%8C%E9%85%8D%E7%BD%AE%E9%87%8D%E6%96%B0%E5%90%AF%E5%8A%A8elasticsearch%E5%92%8CKibana%EF%BC%8C%E5%86%8D%E6%AC%A1%E6%B5%8B%E8%AF%95"><span class="toc-text">3.4、修改完配置重新启动elasticsearch和Kibana，再次测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5%E3%80%81%E5%86%8D%E6%AC%A1%E6%B5%8B%E8%AF%95%EF%BC%8C%E5%8F%91%E7%8E%B0%E9%9B%A8%E5%A5%B3%E6%97%A0%E7%93%9C%E5%8F%98%E6%88%90%E4%BA%86%E4%B8%80%E4%B8%AA%E8%AF%8D"><span class="toc-text">3.5、再次测试，发现雨女无瓜变成了一个词</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81ElasticSearch%E5%9F%BA%E4%BA%8ERest%E9%A3%8E%E6%A0%BC%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-text">六、ElasticSearch基于Rest风格的操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81Rest%E9%A3%8E%E6%A0%BC%E8%AF%B4%E6%98%8E"><span class="toc-text">1、Rest风格说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%85%B3%E4%BA%8E%E7%B4%A2%E5%BC%95%E5%92%8C%E6%96%87%E6%A1%A3%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-text">2、关于索引和文档的操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1%E3%80%81%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%B4%A2%E5%BC%95%E5%92%8C%E6%96%87%E6%A1%A3%EF%BC%8C%E5%BD%93%E7%B4%A2%E5%BC%95%E5%AD%98%E5%9C%A8%E6%97%B6%EF%BC%8C%E4%BB%85%E5%88%9B%E5%BB%BA%E6%96%87%E6%A1%A3"><span class="toc-text">2.1、创建一个索引和文档，当索引存在时，仅创建文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2%E3%80%81%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%B4%A2%E5%BC%95%EF%BC%8C%E5%B9%B6%E6%8C%87%E5%AE%9A%E7%B1%BB%E5%9E%8B"><span class="toc-text">2.2、创建一个索引，并指定类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3%E3%80%81%E6%9F%A5%E7%9C%8B%E7%B4%A2%E5%BC%95-%E6%9F%A5%E7%9C%8B%E6%96%87%E6%A1%A3"><span class="toc-text">2.3、查看索引&#x2F;查看文档</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1%E3%80%81%E6%9F%A5%E7%9C%8B%E7%B4%A2%E5%BC%95"><span class="toc-text">2.3.1、查看索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2%E3%80%81%E6%9F%A5%E7%9C%8B%E6%96%87%E6%A1%A3"><span class="toc-text">2.3.2、查看文档</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4%E3%80%81%E4%BF%AE%E6%94%B9%E6%96%87%E6%A1%A3"><span class="toc-text">2.4、修改文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5%E3%80%81%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95-%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="toc-text">2.5、删除索引&#x2F;删除文档</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-1%E3%80%81%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="toc-text">2.5.1、删除文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-2%E3%80%81%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-text">2.5.2、删除索引</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6%E3%80%81%E6%A0%B9%E6%8D%AE%E5%8D%95%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-text">2.6、根据单条件查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7%E3%80%81%E5%A4%9A%E6%9D%A1%E4%BB%B6%E5%A4%8D%E6%9D%82%E6%9F%A5%E8%AF%A2"><span class="toc-text">2.7、多条件复杂查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-1%E3%80%81%E6%8C%87%E5%AE%9A%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9"><span class="toc-text">2.7.1、指定输出内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-2%E3%80%81%E5%AF%B9%E7%BB%93%E6%9E%9C%E6%A0%B9%E6%8D%AE%E6%8C%87%E5%AE%9A%E5%86%85%E5%AE%B9%E8%BF%9B%E8%A1%8C%E6%8E%92%E5%BA%8F"><span class="toc-text">2.7.2、对结果根据指定内容进行排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-3%E3%80%81%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-text">2.7.3、分页查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-4%E3%80%81%E5%B8%83%E5%B0%94%E6%9F%A5%E8%AF%A2"><span class="toc-text">2.7.4、布尔查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-5%E3%80%81%E8%BF%87%E6%BB%A4%E5%99%A8%E6%9F%A5%E8%AF%A2"><span class="toc-text">2.7.5、过滤器查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-6%E3%80%81%E5%90%8C%E4%B8%80%E4%B8%AA%E5%AD%97%E6%AE%B5%E5%A4%9A%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-text">2.7.6、同一个字段多条件查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-7%E3%80%81%E7%B2%BE%E7%A1%AE%E6%9F%A5%E8%AF%A2"><span class="toc-text">2.7.7、精确查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-8%E3%80%81%E9%AB%98%E4%BA%AE%E6%9F%A5%E8%AF%A2"><span class="toc-text">2.7.8、高亮查询</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%83%E3%80%81springboot%E9%9B%86%E6%88%90ElasticSearch"><span class="toc-text">七、springboot集成ElasticSearch</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%88%9B%E5%BB%BA%E6%B5%8B%E8%AF%95%E5%B7%A5%E7%A8%8B"><span class="toc-text">1、创建测试工程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E4%BF%AE%E6%94%B9pom%E6%96%87%E4%BB%B6"><span class="toc-text">2、修改pom文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E7%BC%96%E5%86%99RestHighLevelClient%E4%BD%9C%E4%B8%BA%E8%BF%9E%E6%8E%A5%E4%B8%8E%E6%93%8D%E4%BD%9Ces%E7%9A%84%E5%AF%B9%E8%B1%A1"><span class="toc-text">3、编写RestHighLevelClient作为连接与操作es的对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E5%85%B3%E4%BA%8E%E7%B4%A2%E5%BC%95%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-text">4、关于索引的操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1%E3%80%81%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-text">4.1、创建索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2%E3%80%81%E5%88%A4%E6%96%AD%E7%B4%A2%E5%BC%95%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8"><span class="toc-text">4.2、判断索引是否存在</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3%E3%80%81%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-text">4.3、删除索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4%E3%80%81%E5%88%9B%E5%BB%BA%E6%96%87%E6%A1%A3"><span class="toc-text">4.4、创建文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5%E3%80%81%E5%88%A4%E6%96%AD%E6%96%87%E6%A1%A3%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8"><span class="toc-text">4.5、判断文档是否存在</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6%E3%80%81%E6%9F%A5%E8%AF%A2%E6%96%87%E6%A1%A3%E4%BF%A1%E6%81%AF"><span class="toc-text">4.6、查询文档信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7%E3%80%81%E4%BF%AE%E6%94%B9%E6%96%87%E6%A1%A3"><span class="toc-text">4.7、修改文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-8%E3%80%81%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="toc-text">4.8、删除文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-11%E3%80%81%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-text">4.11、批量插入数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-10%E3%80%81%E6%90%9C%E7%B4%A2"><span class="toc-text">4.10、搜索</span></a></li></ol></li></ol></li></ol></div></div></div><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/blog/2021/06/01/MyCat/" title="MyCat"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="MyCat"/></a><div class="content"><a class="title" href="/blog/2021/06/01/MyCat/" title="MyCat">MyCat</a><time datetime="2021-06-01T14:00:00.000Z" title="发表于 2021-06-01 22:00:00">2021-06-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blog/2021/05/21/MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" title="MySQL主从复制"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="MySQL主从复制"/></a><div class="content"><a class="title" href="/blog/2021/05/21/MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" title="MySQL主从复制">MySQL主从复制</a><time datetime="2021-05-21T14:00:00.000Z" title="发表于 2021-05-21 22:00:00">2021-05-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blog/2021/05/15/MySQL%E9%94%81%E4%B8%8E%E6%97%A5%E5%BF%97/" title="MySQL锁与日志"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="MySQL锁与日志"/></a><div class="content"><a class="title" href="/blog/2021/05/15/MySQL%E9%94%81%E4%B8%8E%E6%97%A5%E5%BF%97/" title="MySQL锁与日志">MySQL锁与日志</a><time datetime="2021-05-15T14:00:00.000Z" title="发表于 2021-05-15 22:00:00">2021-05-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blog/2021/05/10/MySQL%E5%8E%9F%E7%90%86%E4%B8%8E%E4%BC%98%E5%8C%96/" title="MySQL原理与优化"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="MySQL原理与优化"/></a><div class="content"><a class="title" href="/blog/2021/05/10/MySQL%E5%8E%9F%E7%90%86%E4%B8%8E%E4%BC%98%E5%8C%96/" title="MySQL原理与优化">MySQL原理与优化</a><time datetime="2021-05-10T14:00:00.000Z" title="发表于 2021-05-10 22:00:00">2021-05-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blog/2021/05/04/JUC%EF%BC%88%E4%B8%8B%EF%BC%89/" title="JUC（下）"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="JUC（下）"/></a><div class="content"><a class="title" href="/blog/2021/05/04/JUC%EF%BC%88%E4%B8%8B%EF%BC%89/" title="JUC（下）">JUC（下）</a><time datetime="2021-05-04T14:00:00.000Z" title="发表于 2021-05-04 22:00:00">2021-05-04</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By WinKing</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/blog/js/utils.js"></script><script src="/blog/js/main.js"></script><script src="/blog/js/tw_cn.js"></script><script src="/blog/js/search/local-search.js"></script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script></div></body></html>